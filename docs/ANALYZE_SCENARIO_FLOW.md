# ARS 시나리오 멘트 흐름 분석

## 개요

이 문서는 KICC Travelport IVR 결제 시스템의 ARS 시나리오 멘트 흐름을 정리합니다.
3건의 다중 주문 결제 시나리오를 기준으로 성공/실패 케이스별 흐름을 설명합니다.

---

## 1. 성공 케이스 (3건 모두 성공)

### 전체 흐름

> **Note**: 삼자통화 안내 및 3초 대기는 `request_type`이 "ARS"인 경우에만 적용됩니다.
> SMS/TKT 타입은 바로 시스템 인사말로 진행됩니다.

```
[통화 시작]
    │
    ▼
[휴대폰 번호 입력]
    "휴대폰 번호를 입력 후 우물 정자를 눌러주세요"
    │
    ▼
[다중 주문 조회]
    (API 호출 - 성공)
    │
    ▼
[request_type 분기]  ← [NEW]
    ├── ARS 타입 (또는 빈값) ──────────────────┐
    │                                         │
    │   [삼자통화/호전환 안내]                   │
    │       "삼초 이내에 삼자 통화 또는          │
    │        호전환하시기 바랍니다"              │
    │       │                                 │
    │       ▼                                 │
    │   [3초 대기]                             │
    │       (POST_TIME 타이머 - 무음 대기)      │
    │       │                                 │
    └───────┼─────────────────────────────────┘
            │
    ├── SMS/TKT 타입 (직접 진입) ──────────────┤
            │
            ▼
[시스템 인사말]  ← [NEW]
    "안녕하세요? 항공권 인증 결재 시스템입니다"
    │
    ▼
[다중 주문 안내]
    "고객님의 항공권 결제 금액은 3건, 총 승인금액은 XXX원입니다"
    │
    ▼
[주문 확인]
    "맞으면 1번, 틀리면 2번을 눌러주세요"
    → 1번 입력
    │
    ▼
[카드번호 뒤 4자리 입력]
    "결제하실 카드번호 뒤 4자리를 입력해 주세요"
    │
    ▼
[비밀번호 입력]
    "카드 비밀번호 4자리 중 앞 2자리를 입력해 주세요"
    │
    ▼
[결제 요청 대기]
    "결제 요청 중입니다. 잠시만 기다려 주시기 바랍니다"
    │
    ▼
[3건 순차 결제 처리]
    (내부적으로 3건 모두 승인 처리)
    │
    ▼
[최종 결과 안내]
    "3건의 결제가 완료되었습니다. 담당직원을 연결해 드리겠습니다"
    │
    ▼
[서비스 종료]
    "감사합니다. 이용해 주셔서 감사합니다"
```

### 상세 멘트 목록

| 단계 | 멘트 내용 | 비고 |
|------|----------|------|
| 1 | "휴대폰 번호를 입력 후 우물 정자를 눌러주세요" | 휴대폰 번호 입력 요청 |
| 2 | "삼초 이내에 삼자 통화 또는 호전환하시기 바랍니다" | **[NEW]** ARS 타입만 적용 |
| 3 | (3초 무음 대기) | **[NEW]** ARS 타입만 적용, POST_TIME 타이머 |
| 4 | "안녕하세요? 항공권 인증 결재 시스템입니다" | **[NEW]** 시스템 인사말 (모든 타입) |
| 5 | "고객님의 항공권 결제 금액은 {N}건, 총 승인금액은 {금액}원입니다" | TTS 동적 생성 |
| 6 | "맞으면 1번, 틀리면 2번을 눌러주세요" | 확인 요청 |
| 7 | "결제하실 카드번호 뒤 4자리를 입력해 주세요" | DB 모드 (앞 12자리는 DB에서 로드) |
| 8 | "카드 비밀번호 4자리 중 앞 2자리를 입력해 주세요" | 비밀번호 입력 |
| 9 | "결제 요청 중입니다. 잠시만 기다려 주시기 바랍니다" | 결제 대기 안내 |
| 10 | "{N}건의 결제가 완료되었습니다. 담당직원을 연결해 드리겠습니다" | 성공 완료 TTS |
| 11 | "감사합니다. 이용해 주셔서 감사합니다" | 종료 멘트 |

> **request_type별 흐름 요약:**
> - **ARS 타입**: 단계 1 → 2 → 3 → 4 → 5 → ... (삼자통화 안내 포함)
> - **SMS/TKT 타입**: 단계 1 → 4 → 5 → ... (삼자통화 안내/대기 생략)

---

## 2. 부분 성공 케이스 (2건 성공, 1건 실패)

### 전체 흐름

```
[통화 시작]
    │
    ▼
[휴대폰 번호 입력]
    "휴대폰 번호를 입력 후 우물 정자를 눌러주세요"
    │
    ▼
[다중 주문 조회 및 안내]
    "고객님의 항공권 결제 금액은 3건, 총 승인금액은 XXX원입니다"
    │
    ▼
[주문 확인]
    "맞으면 1번, 틀리면 2번을 눌러주세요"
    → 1번 입력
    │
    ▼
[카드번호 뒤 4자리 입력]
    "결제하실 카드번호 뒤 4자리를 입력해 주세요"
    │
    ▼
[비밀번호 입력]
    "카드 비밀번호 4자리 중 앞 2자리를 입력해 주세요"
    │
    ▼
[결제 요청 대기]
    "결제 요청 중입니다. 잠시만 기다려 주시기 바랍니다"
    │
    ▼
[3건 순차 결제 처리]
    (2건 성공, 1건 실패 - 내부 처리)
    │
    ▼
[부분 성공 결과 안내]
    "2건은 결제가 완료되었으며 1건은 결제 실패하였습니다.
     담당직원을 연결해 드리겠습니다"
    │
    ▼
[서비스 종료]
    "감사합니다. 이용해 주셔서 감사합니다"
```

### 상세 멘트 목록

| 단계 | 멘트 내용 | 비고 |
|------|----------|------|
| 1-6 | (성공 케이스와 동일) | - |
| 7 | "{성공건수}건은 결제가 완료되었으며 {실패건수}건은 결제 실패하였습니다. 담당직원을 연결해 드리겠습니다" | 부분 성공 TTS |
| 8 | "감사합니다. 이용해 주셔서 감사합니다" | 종료 멘트 |

---

## 3. 전부 실패 케이스 (3건 모두 실패)

### 시나리오 A: 재결제 선택

```
[통화 시작]
    │
    ▼
[휴대폰 번호 입력]
    "휴대폰 번호를 입력 후 우물 정자를 눌러주세요"
    │
    ▼
[다중 주문 조회 및 안내]
    "고객님의 항공권 결제 금액은 3건, 총 승인금액은 XXX원입니다"
    │
    ▼
[주문 확인]
    "맞으면 1번, 틀리면 2번을 눌러주세요"
    → 1번 입력
    │
    ▼
[카드번호 뒤 4자리 입력]
    "결제하실 카드번호 뒤 4자리를 입력해 주세요"
    │
    ▼
[비밀번호 입력]
    "카드 비밀번호 4자리 중 앞 2자리를 입력해 주세요"
    │
    ▼
[결제 요청 대기]
    "결제 요청 중입니다. 잠시만 기다려 주시기 바랍니다"
    │
    ▼
[3건 순차 결제 처리]
    (3건 모두 실패 - 내부 처리)
    │
    ▼
[전부 실패 안내 및 선택]
    "3건 결제가 모두 실패하였습니다.
     다시 결제를 진행하시려면 1번,
     담당 직원을 연결하시려면 2번을 눌러 주시기 바랍니다"
    │
    ├─── 1번 입력 ───────────────────────────┐
    │                                        ▼
    │                            [카드번호 뒤 4자리 재입력]
    │                                "결제하실 카드번호 뒤 4자리를 입력해 주세요"
    │                                        │
    │                                        ▼
    │                            [비밀번호 입력]
    │                                "카드 비밀번호 4자리 중 앞 2자리를 입력해 주세요"
    │                                        │
    │                                        ▼
    │                            [결제 요청 대기]
    │                                "결제 요청 중입니다. 잠시만 기다려 주시기 바랍니다"
    │                                        │
    │                                        ▼
    │                            [결제 처리 및 결과 안내]
    │                                (결과에 따른 분기)
    │
    └─── 2번 입력 ───────────────────────────┐
                                             ▼
                                [서비스 종료]
                                    "감사합니다. 이용해 주셔서 감사합니다"
```

### 시나리오 B: 재시도 횟수 초과 (3회 실패)

```
[결제 시도 1회차]
    │
    ▼ (3건 모두 실패)
    │
[전부 실패 안내]
    "3건 결제가 모두 실패하였습니다.
     다시 결제를 진행하시려면 1번..."
    → 1번 입력 (재결제 선택)
    │
    ▼
[결제 시도 2회차]
    │
    ▼ (3건 모두 실패)
    │
[전부 실패 안내]
    "3건 결제가 모두 실패하였습니다.
     다시 결제를 진행하시려면 1번..."
    → 1번 입력 (재결제 선택)
    │
    ▼
[결제 시도 3회차]
    │
    ▼ (3건 모두 실패)
    │
[최종 실패 안내]
    "결제에 실패하였습니다. 다시 전화해 주시기 바랍니다"
    │
    ▼
[서비스 종료]
    "감사합니다. 이용해 주셔서 감사합니다"
```

### 상세 멘트 목록 (전부 실패)

| 단계 | 멘트 내용 | 비고 |
|------|----------|------|
| 1-6 | (성공 케이스와 동일) | - |
| 7a | "{실패건수}건 결제가 모두 실패하였습니다. 다시 결제를 진행하시려면 1번, 담당 직원을 연결하시려면 2번을 눌러 주시기 바랍니다" | 재시도 가능 시 (1~2회차) |
| 7b | "결제에 실패하였습니다. 다시 전화해 주시기 바랍니다" | 재시도 횟수 초과 시 (3회차) |
| 8 | "감사합니다. 이용해 주셔서 감사합니다" | 종료 멘트 |

---

## 4. 종합 흐름도 (Flowchart)

```
                        ┌─────────────────┐
                        │   통화 시작      │
                        └────────┬────────┘
                                 │
                                 ▼
                ┌─────────────────────────────────┐
                │ "휴대폰 번호를 입력 후           │
                │  우물 정자를 눌러주세요"         │
                └────────────────┬────────────────┘
                                 │
                                 ▼
                        ┌───────────────┐
                        │ 전화번호 입력  │
                        └───────┬───────┘
                                │
                                ▼
                        ┌───────────────┐
                        │ 다중 주문 조회 │
                        └───────┬───────┘
                                │
                   ┌────────────┼────────────┐
                   │            │            │
           주문 없음          주문 조회 실패      주문 있음
                   │            │            │
                   ▼            ▼            ▼
        ┌──────────────┐  ┌──────────────┐  │
        │ "주문이 없습니다"│  │  시스템 오류   │  │
        └───────┬──────┘  └──────┬───────┘  │
                │               │          │
                ▼               ▼          │
        ┌──────────────┐  ┌──────────────┐  │
        │ 전화번호 재입력│  │   서비스 종료  │  │
        │ (최대 3회)    │  └──────────────┘  │
        └──────────────┘                    │
                                           │
                                           ▼
                ┌─────────────────────────────────┐
                │ "고객님의 항공권 결제 금액은      │
                │  {N}건, 총 승인금액은 {금액}원입니다" │
                └────────────────┬────────────────┘
                                 │
                                 ▼
                ┌─────────────────────────────────┐
                │ "맞으면 1번, 틀리면 2번을         │
                │  눌러주세요"                     │
                └────────────────┬────────────────┘
                                 │
                   ┌─────────────┴─────────────┐
                   │                           │
               1번 (예)                     2번 (아니오)
                   │                           │
                   ▼                           ▼
                   │                  ┌────────────────┐
                   │                  │ 전화번호 재입력 │
                   │                  └────────────────┘
                   │
                   ▼
    ┌─────────────────────────────────┐
    │ "결제하실 카드번호 뒤 4자리를     │
    │  입력해 주세요"                  │
    └────────────────┬────────────────┘
                     │
                     ▼
              ┌─────────────┐
              │ 4자리 입력   │
              └──────┬──────┘
                     │
                     ▼
    ┌─────────────────────────────────┐
    │ "카드 비밀번호 4자리 중           │
    │  앞 2자리를 입력해 주세요"       │
    └────────────────┬────────────────┘
                     │
                     ▼
              ┌─────────────┐
              │ 2자리 입력   │
              └──────┬──────┘
                     │
                     ▼
    ┌─────────────────────────────────┐
    │ "결제 요청 중입니다.             │
    │  잠시만 기다려 주시기 바랍니다"   │
    └────────────────┬────────────────┘
                     │
                     ▼
              ┌─────────────────┐
              │  {N}건 결제 처리  │
              └────────┬────────┘
                       │
         ┌─────────────┼─────────────┐
         │             │             │
     전부 성공      부분 성공      전부 실패
         │             │             │
         ▼             ▼             ▼
┌────────────────┐ ┌────────────────┐ ┌────────────────────┐
│ "{N}건의 결제가  │ │ "{성공}건은     │ │ 재시도 횟수 확인    │
│  완료되었습니다. │ │  결제가        │ │ (최대 3회)         │
│  담당직원을     │ │  완료되었으며   │ └─────────┬──────────┘
│  연결해         │ │  {실패}건은     │           │
│  드리겠습니다"  │ │  실패하였습니다.│    ┌──────┴──────┐
└───────┬────────┘ │  담당직원을     │    │             │
        │          │  연결해         │ 3회 미만     3회 초과
        │          │  드리겠습니다"  │    │             │
        │          └───────┬────────┘    ▼             ▼
        │                  │      ┌────────────┐ ┌──────────────┐
        │                  │      │ "{N}건 결제가│ │ "결제에       │
        │                  │      │  모두       │ │  실패하였습니다.│
        │                  │      │  실패하였습니다│ │  다시 전화해   │
        │                  │      │  다시 결제를 │ │  주시기       │
        │                  │      │  진행하시려면│ │  바랍니다"    │
        │                  │      │  1번..."    │ └──────┬───────┘
        │                  │      └──────┬─────┘        │
        │                  │             │              │
        │                  │    ┌────────┴────────┐     │
        │                  │    │                 │     │
        │                  │ 1번 (재결제)     2번 (종료)  │
        │                  │    │                 │     │
        │                  │    ▼                 ▼     │
        │                  │ ┌───────────┐  ┌────────┐  │
        │                  │ │카드번호 입력│  │        │  │
        │                  │ │(상단으로)  │  │        │  │
        │                  │ └───────────┘  │        │  │
        │                  │                │        │  │
        └──────────────────┴────────────────┴────────┴──┘
                                    │
                                    ▼
                    ┌─────────────────────────────────┐
                    │ "감사합니다.                     │
                    │  이용해 주셔서 감사합니다"        │
                    └────────────────┬────────────────┘
                                     │
                                     ▼
                              ┌─────────────┐
                              │   통화 종료  │
                              └─────────────┘
```

---

## 5. 오류 상황별 멘트

### 5.1 휴대폰 번호 입력 오류

| 상황 | 멘트 | 처리 |
|------|------|------|
| 형식 오류 | "잘못 누르셨습니다" | 재입력 안내 |
| 주문 없음 | "주문이 조회되지 않습니다. 확인 후 다시 전화해 주시기 바랍니다" | 3회 재시도 후 종료 |
| 시스템 오류 | "시스템 오류가 발생했습니다" | 서비스 종료 |

### 5.2 카드 입력 오류

| 상황 | 멘트 | 처리 |
|------|------|------|
| 형식 오류 | "잘못 누르셨습니다" | 재입력 안내 |
| 카드번호 불일치 | "잘못 누르셨습니다" | 재입력 안내 |

### 5.3 결제 처리 오류

| 상황 | 멘트 | 처리 |
|------|------|------|
| 결제 실패 | "고객님, {사유}로 인해 결제 실패하였습니다" | 실패 사유 안내 후 분기 |
| 시스템 장애 | "시스템 오류가 발생했습니다" | 서비스 종료 |
| TTS 타임아웃 | "현재 통화량이 많아 지연 상황이 발생하고 있습니다" | 서비스 종료 |

---

## 6. 음성 파일 맵핑

| 멘트 ID | 파일 경로 | 설명 |
|---------|----------|------|
| input_telnum_start | ment/Travelport/input_telnum_start | 휴대폰 번호 입력 안내 |
| **transfer_guide** | **ment/Travelport/transfer_guide** | **[NEW] 삼자통화/호전환 안내** |
| **intro** | **ment/Travelport/intro** | **[NEW] 시스템 인사말** |
| input_card_num_4 | ment/Travelport/input_card_num_4 | 카드번호 뒤 4자리 입력 |
| input_pass_start | ment/Travelport/input_pass_start | 비밀번호 입력 안내 |
| pay_request_wait | ment/Travelport/pay_request_wait | 결제 요청 대기 안내 |
| no_order_msg | ment/Travelport/no_order_msg | 주문 없음 안내 |
| pay_success_msg | ment/Travelport/pay_success_msg | 결제 완료 안내 |
| input_confirm | ment/_common/common_audio/input_confirm | "맞으면 1번, 틀리면 2번" |
| service_end | ment/_common/common_audio/service_end | 서비스 종료 안내 |
| TTS_TimeOut | ment/TTS_TimeOut | TTS 타임아웃 안내 |

### 6.1 신규 음성 파일 상세 [NEW]

| 파일명 | 멘트 내용 | 예상 길이 | 구현 방식 |
|--------|----------|----------|----------|
| transfer_guide.wav | "삼초 이내에 삼자 통화 또는 호전환하시기 바랍니다" | 약 3초 | 음성 파일 재생 |
| intro.wav | "안녕하세요? 항공권 인증 결재 시스템입니다" | 약 2.5초 | 음성 파일 재생 |
| (3초 대기) | - | 정확히 3초 | **POST_TIME 타이머** (파일 불필요) |

---

## 7. 참고사항

### 7.1 DB 카드 모드 (m_bUseDbCardInfo = TRUE)

현재 시스템은 DB 카드 모드로 동작합니다:
- 카드번호 앞 12자리: DB(RESERVED_3)에서 로드
- 유효기간: DB(RESERVED_4)에서 로드
- 할부개월: DB(RESERVED_5)에서 로드
- 사용자 입력: 카드번호 뒤 4자리 + 비밀번호 앞 2자리만

### 7.2 재시도 제한

| 항목 | 최대 횟수 |
|------|----------|
| 휴대폰 번호 입력 | 3회 |
| 카드번호 재입력 (전부 실패 시) | 3회 |
| DTMF 입력 재안내 | 3회 |

### 7.3 TTS 동적 생성

다음 멘트는 TTS로 동적 생성됩니다:
- 주문 정보 안내 (건수, 금액)
- 결제 결과 안내 (성공/실패 건수)
- 실패 사유 안내

### 7.4 삼자통화/호전환 대기 구현 [NEW]

주문조회 성공 후 상담원이 삼자통화/호전환에 참여할 수 있도록 대기 시간을 제공합니다.
**단, request_type에 따라 적용 여부가 달라집니다.**

#### request_type 기반 분기

| request_type | 삼자통화 안내 | 3초 대기 | 인사말 | 설명 |
|--------------|--------------|---------|--------|------|
| **ARS** (또는 빈값) | ✅ 적용 | ✅ 적용 | ✅ 적용 | 상담원 호전환 대기 필요 |
| **SMS** | ❌ 미적용 | ❌ 미적용 | ✅ 적용 | SMS 주문, 호전환 불필요 |
| **TKT** | ❌ 미적용 | ❌ 미적용 | ✅ 적용 | 티켓 주문, 호전환 불필요 |

**분기 로직:**
```cpp
// request_type이 "SMS" 또는 "TKT"인 경우에만 호전환 생략
// 빈 값이거나 "ARS"이면 호전환 멘트 재생 (기본값 = ARS 동작)
if (strcmp(m_szRequestType, "SMS") == 0 || strcmp(m_szRequestType, "TKT") == 0)
{
    return KICC_ArsScenarioStart(12);  // 바로 인사말로 진행
}
else
{
    return KICC_ArsScenarioStart(10);  // 삼자통화 안내부터 시작
}
```

#### 상태(State) 번호

| State | 역할 | 적용 조건 | 비고 |
|-------|------|----------|------|
| 10 | 삼자통화 안내 | ARS 타입만 | 주문조회 성공 후 진입 |
| 11 | 3초 대기 | ARS 타입만 | POST_TIME 타이머 사용 |
| 12 | 시스템 인사말 | 모든 타입 | 인사 후 결제 안내 진행 |

#### 3초 대기 구현 방식

**POST_TIME 타이머 사용** (음성 파일 불필요):
```cpp
// Case 11: 3초 대기 - POST_TIME 타이머 사용
case 11:
    info_printf(localCh, "KICC_ArsScenarioStart [%d] 3초 대기 중...", state);
    eprintf("KICC_ArsScenarioStart [%d] 3초 대기 - POST_TIME 사용", state);
    setPostfunc(POST_TIME, KICC_ArsScenarioStart, 12, 3);  // 3초 후 Case 12로
    return 0;  // 타이머 대기 상태
```

- `POST_TIME`: WinIVR 시스템의 타이머 기반 대기 기능
- `wtime=3`: 3초 후 콜백 함수 호출
- 별도 음성 파일 없이 정확한 시간 대기 가능

#### 주문조회 실패 시 처리

주문조회 실패 시 삼자통화 안내 없이 즉시 전화번호 재입력 화면(Case 1)으로 복귀합니다.

### 7.5 발신번호(ANI) 자동 조회 [NEW - 2025-12-22]

통화 시작 시 발신번호가 유효한 휴대폰 번호인 경우, 전화번호 입력을 건너뛰고 자동으로 주문을 조회합니다.
이 기능은 사용자 편의를 위해 추가되었으며, 기존 수동 입력 흐름과 병행됩니다.

#### 유효한 휴대폰 번호 판단 기준

다음 접두사로 시작하는 10~11자리 숫자:
- `010`, `011`, `016`, `017`, `018`, `019`

#### 분기 흐름도

```
[통화 시작]
    │
    ▼
[Case 20: 발신번호(ANI) 분기점]
    │
    ├── 조건: ANI 유효 & 미조회 (m_bAniChecked == FALSE)
    │   │
    │   ▼
    │   [ANI로 주문조회 시도]
    │   setPostfunc(POST_NET, KICC_ArsScenarioStart, 21, 0)
    │   │
    │   ▼
    │   [Case 21: ANI 조회 결과 처리]
    │       │
    │       ├── 성공 (주문 있음) ───────────────────────┐
    │       │   │                                      │
    │       │   ├── ARS 타입 → Case 10 (삼자통화 안내)  │
    │       │   └── SMS/TKT 타입 → Case 12 (인사말)    │
    │       │                                          │
    │       └── 실패 (주문 없음/DB 오류) ────────────────┤
    │           │                                      │
    │           ▼                                      │
    │       [Case 1: 전화번호 입력]  ← 멘트 없이 바로 이동│
    │                                                  │
    └── 조건: ANI 무효 또는 이미 조회 ─────────────────────┘
        │
        ▼
    [Case 1: 전화번호 입력]
        "휴대폰 번호를 입력 후 우물 정자를 눌러주세요"
```

#### 상태(State) 번호

| State | 역할 | 조건 | 다음 State |
|-------|------|------|-----------|
| 20 | ANI 분기점 | ANI 유효 & 미조회 | 21 (조회) 또는 1 (입력) |
| 21 | ANI 조회 결과 처리 | 조회 성공 | 10 또는 12 |
| 21 | ANI 조회 결과 처리 | 조회 실패 | 1 (멘트 없음) |

#### 핵심 로직

```cpp
// Case 20: 발신번호 조회 조건 확인
case 20:
{
    if (!pScenario->m_bAniChecked && IsValidMobileNumber(pScenario->szAni))
    {
        // 발신번호를 입력 전화번호로 설정
        strncpy(pScenario->m_szInputTel, pScenario->szAni, sizeof(pScenario->m_szInputTel) - 1);

        // 조회 시도 플래그 설정 (중복 조회 방지)
        pScenario->m_bAniChecked = TRUE;

        // 다중 주문 조회 시작
        setPostfunc(POST_NET, KICC_ArsScenarioStart, 21, 0);
        return getMultiOrderInfo_host(90);
    }
    else
    {
        // ANI 무효 또는 이미 조회 → 전화번호 입력
        return KICC_ArsScenarioStart(1);
    }
}

// Case 21: ANI 조회 결과 처리
case 21:
{
    if (pScenario->m_DBAccess == -1 || pScenario->m_MultiOrders.nOrderCount == 0)
    {
        // 주문 없음 → 멘트 없이 바로 전화번호 입력
        return KICC_ArsScenarioStart(1);
    }

    // 주문조회 성공 → request_type에 따라 분기
    if (strcmp(pScenario->m_szRequestType, "SMS") == 0 ||
        strcmp(pScenario->m_szRequestType, "TKT") == 0)
    {
        return KICC_ArsScenarioStart(12);  // 바로 인사말
    }
    else
    {
        return KICC_ArsScenarioStart(10);  // 삼자통화 안내
    }
}
```

#### 사용자 경험 (UX) 개선 포인트

| 상황 | 처리 방식 | 이유 |
|------|----------|------|
| ANI 조회 성공 | 전화번호 입력 생략 → 바로 결제 진행 | 사용자 입력 단계 감소 |
| ANI 조회 실패 | 멘트 없이 전화번호 입력으로 이동 | "주문없음" 멘트가 혼란을 줄 수 있음 |
| ANI 무효 (유선전화 등) | 기존 흐름대로 전화번호 입력 | 하위 호환성 유지 |

#### 관련 멤버 변수

```cpp
// KICC_Travelport_Scenario.h
BOOL m_bAniChecked;  // 발신번호 조회 시도 여부 (TRUE: 이미 시도함, FALSE: 미시도)
```

#### 주의사항

1. **1회 시도 원칙**: ANI 조회는 통화당 1회만 시도됩니다. 실패 후 사용자가 전화번호를 입력하면 해당 번호로 조회합니다.
2. **플래그 초기화**: `m_bAniChecked`는 `ScenarioInit()`에서 FALSE로 초기화됩니다.
3. **기존 흐름 유지**: ANI 조회 실패 시 기존 수동 입력 흐름으로 자연스럽게 전환됩니다.
