# ARS 시나리오 멘트 흐름 분석

## 개요

이 문서는 KICC Travelport IVR 결제 시스템의 ARS 시나리오 멘트 흐름을 정리합니다.
3건의 다중 주문 결제 시나리오를 기준으로 성공/실패 케이스별 흐름을 설명합니다.

---

## 1. 성공 케이스 (3건 모두 성공)

### 전체 흐름

```
[통화 시작]
    │
    ▼
[휴대폰 번호 입력]
    "휴대폰 번호를 입력 후 우물 정자를 눌러주세요"
    │
    ▼
[다중 주문 조회 및 안내]
    "고객님의 항공권 결제 금액은 3건, 총 승인금액은 XXX원입니다"
    │
    ▼
[주문 확인]
    "맞으면 1번, 틀리면 2번을 눌러주세요"
    → 1번 입력
    │
    ▼
[카드번호 뒤 4자리 입력]
    "결제하실 카드번호 뒤 4자리를 입력해 주세요"
    │
    ▼
[비밀번호 입력]
    "카드 비밀번호 4자리 중 앞 2자리를 입력해 주세요"
    │
    ▼
[결제 요청 대기]
    "결제 요청 중입니다. 잠시만 기다려 주시기 바랍니다"
    │
    ▼
[3건 순차 결제 처리]
    (내부적으로 3건 모두 승인 처리)
    │
    ▼
[최종 결과 안내]
    "3건의 결제가 완료되었습니다. 담당직원을 연결해 드리겠습니다"
    │
    ▼
[서비스 종료]
    "감사합니다. 이용해 주셔서 감사합니다"
```

### 상세 멘트 목록

| 단계 | 멘트 내용 | 비고 |
|------|----------|------|
| 1 | "휴대폰 번호를 입력 후 우물 정자를 눌러주세요" | 휴대폰 번호 입력 요청 |
| 2 | "고객님의 항공권 결제 금액은 {N}건, 총 승인금액은 {금액}원입니다" | TTS 동적 생성 |
| 3 | "맞으면 1번, 틀리면 2번을 눌러주세요" | 확인 요청 |
| 4 | "결제하실 카드번호 뒤 4자리를 입력해 주세요" | DB 모드 (앞 12자리는 DB에서 로드) |
| 5 | "카드 비밀번호 4자리 중 앞 2자리를 입력해 주세요" | 비밀번호 입력 |
| 6 | "결제 요청 중입니다. 잠시만 기다려 주시기 바랍니다" | 결제 대기 안내 |
| 7 | "{N}건의 결제가 완료되었습니다. 담당직원을 연결해 드리겠습니다" | 성공 완료 TTS |
| 8 | "감사합니다. 이용해 주셔서 감사합니다" | 종료 멘트 |

---

## 2. 부분 성공 케이스 (2건 성공, 1건 실패)

### 전체 흐름

```
[통화 시작]
    │
    ▼
[휴대폰 번호 입력]
    "휴대폰 번호를 입력 후 우물 정자를 눌러주세요"
    │
    ▼
[다중 주문 조회 및 안내]
    "고객님의 항공권 결제 금액은 3건, 총 승인금액은 XXX원입니다"
    │
    ▼
[주문 확인]
    "맞으면 1번, 틀리면 2번을 눌러주세요"
    → 1번 입력
    │
    ▼
[카드번호 뒤 4자리 입력]
    "결제하실 카드번호 뒤 4자리를 입력해 주세요"
    │
    ▼
[비밀번호 입력]
    "카드 비밀번호 4자리 중 앞 2자리를 입력해 주세요"
    │
    ▼
[결제 요청 대기]
    "결제 요청 중입니다. 잠시만 기다려 주시기 바랍니다"
    │
    ▼
[3건 순차 결제 처리]
    (2건 성공, 1건 실패 - 내부 처리)
    │
    ▼
[부분 성공 결과 안내]
    "2건은 결제가 완료되었으며 1건은 결제 실패하였습니다.
     담당직원을 연결해 드리겠습니다"
    │
    ▼
[서비스 종료]
    "감사합니다. 이용해 주셔서 감사합니다"
```

### 상세 멘트 목록

| 단계 | 멘트 내용 | 비고 |
|------|----------|------|
| 1-6 | (성공 케이스와 동일) | - |
| 7 | "{성공건수}건은 결제가 완료되었으며 {실패건수}건은 결제 실패하였습니다. 담당직원을 연결해 드리겠습니다" | 부분 성공 TTS |
| 8 | "감사합니다. 이용해 주셔서 감사합니다" | 종료 멘트 |

---

## 3. 전부 실패 케이스 (3건 모두 실패)

### 시나리오 A: 재결제 선택

```
[통화 시작]
    │
    ▼
[휴대폰 번호 입력]
    "휴대폰 번호를 입력 후 우물 정자를 눌러주세요"
    │
    ▼
[다중 주문 조회 및 안내]
    "고객님의 항공권 결제 금액은 3건, 총 승인금액은 XXX원입니다"
    │
    ▼
[주문 확인]
    "맞으면 1번, 틀리면 2번을 눌러주세요"
    → 1번 입력
    │
    ▼
[카드번호 뒤 4자리 입력]
    "결제하실 카드번호 뒤 4자리를 입력해 주세요"
    │
    ▼
[비밀번호 입력]
    "카드 비밀번호 4자리 중 앞 2자리를 입력해 주세요"
    │
    ▼
[결제 요청 대기]
    "결제 요청 중입니다. 잠시만 기다려 주시기 바랍니다"
    │
    ▼
[3건 순차 결제 처리]
    (3건 모두 실패 - 내부 처리)
    │
    ▼
[전부 실패 안내 및 선택]
    "3건 결제가 모두 실패하였습니다.
     다시 결제를 진행하시려면 1번,
     담당 직원을 연결하시려면 2번을 눌러 주시기 바랍니다"
    │
    ├─── 1번 입력 ───────────────────────────┐
    │                                        ▼
    │                            [카드번호 뒤 4자리 재입력]
    │                                "결제하실 카드번호 뒤 4자리를 입력해 주세요"
    │                                        │
    │                                        ▼
    │                            [비밀번호 입력]
    │                                "카드 비밀번호 4자리 중 앞 2자리를 입력해 주세요"
    │                                        │
    │                                        ▼
    │                            [결제 요청 대기]
    │                                "결제 요청 중입니다. 잠시만 기다려 주시기 바랍니다"
    │                                        │
    │                                        ▼
    │                            [결제 처리 및 결과 안내]
    │                                (결과에 따른 분기)
    │
    └─── 2번 입력 ───────────────────────────┐
                                             ▼
                                [서비스 종료]
                                    "감사합니다. 이용해 주셔서 감사합니다"
```

### 시나리오 B: 재시도 횟수 초과 (3회 실패)

```
[결제 시도 1회차]
    │
    ▼ (3건 모두 실패)
    │
[전부 실패 안내]
    "3건 결제가 모두 실패하였습니다.
     다시 결제를 진행하시려면 1번..."
    → 1번 입력 (재결제 선택)
    │
    ▼
[결제 시도 2회차]
    │
    ▼ (3건 모두 실패)
    │
[전부 실패 안내]
    "3건 결제가 모두 실패하였습니다.
     다시 결제를 진행하시려면 1번..."
    → 1번 입력 (재결제 선택)
    │
    ▼
[결제 시도 3회차]
    │
    ▼ (3건 모두 실패)
    │
[최종 실패 안내]
    "결제에 실패하였습니다. 다시 전화해 주시기 바랍니다"
    │
    ▼
[서비스 종료]
    "감사합니다. 이용해 주셔서 감사합니다"
```

### 상세 멘트 목록 (전부 실패)

| 단계 | 멘트 내용 | 비고 |
|------|----------|------|
| 1-6 | (성공 케이스와 동일) | - |
| 7a | "{실패건수}건 결제가 모두 실패하였습니다. 다시 결제를 진행하시려면 1번, 담당 직원을 연결하시려면 2번을 눌러 주시기 바랍니다" | 재시도 가능 시 (1~2회차) |
| 7b | "결제에 실패하였습니다. 다시 전화해 주시기 바랍니다" | 재시도 횟수 초과 시 (3회차) |
| 8 | "감사합니다. 이용해 주셔서 감사합니다" | 종료 멘트 |

---

## 4. 종합 흐름도 (Flowchart)

```
                        ┌─────────────────┐
                        │   통화 시작      │
                        └────────┬────────┘
                                 │
                                 ▼
                ┌─────────────────────────────────┐
                │ "휴대폰 번호를 입력 후           │
                │  우물 정자를 눌러주세요"         │
                └────────────────┬────────────────┘
                                 │
                                 ▼
                        ┌───────────────┐
                        │ 전화번호 입력  │
                        └───────┬───────┘
                                │
                                ▼
                        ┌───────────────┐
                        │ 다중 주문 조회 │
                        └───────┬───────┘
                                │
                   ┌────────────┼────────────┐
                   │            │            │
           주문 없음          주문 조회 실패      주문 있음
                   │            │            │
                   ▼            ▼            ▼
        ┌──────────────┐  ┌──────────────┐  │
        │ "주문이 없습니다"│  │  시스템 오류   │  │
        └───────┬──────┘  └──────┬───────┘  │
                │               │          │
                ▼               ▼          │
        ┌──────────────┐  ┌──────────────┐  │
        │ 전화번호 재입력│  │   서비스 종료  │  │
        │ (최대 3회)    │  └──────────────┘  │
        └──────────────┘                    │
                                           │
                                           ▼
                ┌─────────────────────────────────┐
                │ "고객님의 항공권 결제 금액은      │
                │  {N}건, 총 승인금액은 {금액}원입니다" │
                └────────────────┬────────────────┘
                                 │
                                 ▼
                ┌─────────────────────────────────┐
                │ "맞으면 1번, 틀리면 2번을         │
                │  눌러주세요"                     │
                └────────────────┬────────────────┘
                                 │
                   ┌─────────────┴─────────────┐
                   │                           │
               1번 (예)                     2번 (아니오)
                   │                           │
                   ▼                           ▼
                   │                  ┌────────────────┐
                   │                  │ 전화번호 재입력 │
                   │                  └────────────────┘
                   │
                   ▼
    ┌─────────────────────────────────┐
    │ "결제하실 카드번호 뒤 4자리를     │
    │  입력해 주세요"                  │
    └────────────────┬────────────────┘
                     │
                     ▼
              ┌─────────────┐
              │ 4자리 입력   │
              └──────┬──────┘
                     │
                     ▼
    ┌─────────────────────────────────┐
    │ "카드 비밀번호 4자리 중           │
    │  앞 2자리를 입력해 주세요"       │
    └────────────────┬────────────────┘
                     │
                     ▼
              ┌─────────────┐
              │ 2자리 입력   │
              └──────┬──────┘
                     │
                     ▼
    ┌─────────────────────────────────┐
    │ "결제 요청 중입니다.             │
    │  잠시만 기다려 주시기 바랍니다"   │
    └────────────────┬────────────────┘
                     │
                     ▼
              ┌─────────────────┐
              │  {N}건 결제 처리  │
              └────────┬────────┘
                       │
         ┌─────────────┼─────────────┐
         │             │             │
     전부 성공      부분 성공      전부 실패
         │             │             │
         ▼             ▼             ▼
┌────────────────┐ ┌────────────────┐ ┌────────────────────┐
│ "{N}건의 결제가  │ │ "{성공}건은     │ │ 재시도 횟수 확인    │
│  완료되었습니다. │ │  결제가        │ │ (최대 3회)         │
│  담당직원을     │ │  완료되었으며   │ └─────────┬──────────┘
│  연결해         │ │  {실패}건은     │           │
│  드리겠습니다"  │ │  실패하였습니다.│    ┌──────┴──────┐
└───────┬────────┘ │  담당직원을     │    │             │
        │          │  연결해         │ 3회 미만     3회 초과
        │          │  드리겠습니다"  │    │             │
        │          └───────┬────────┘    ▼             ▼
        │                  │      ┌────────────┐ ┌──────────────┐
        │                  │      │ "{N}건 결제가│ │ "결제에       │
        │                  │      │  모두       │ │  실패하였습니다.│
        │                  │      │  실패하였습니다│ │  다시 전화해   │
        │                  │      │  다시 결제를 │ │  주시기       │
        │                  │      │  진행하시려면│ │  바랍니다"    │
        │                  │      │  1번..."    │ └──────┬───────┘
        │                  │      └──────┬─────┘        │
        │                  │             │              │
        │                  │    ┌────────┴────────┐     │
        │                  │    │                 │     │
        │                  │ 1번 (재결제)     2번 (종료)  │
        │                  │    │                 │     │
        │                  │    ▼                 ▼     │
        │                  │ ┌───────────┐  ┌────────┐  │
        │                  │ │카드번호 입력│  │        │  │
        │                  │ │(상단으로)  │  │        │  │
        │                  │ └───────────┘  │        │  │
        │                  │                │        │  │
        └──────────────────┴────────────────┴────────┴──┘
                                    │
                                    ▼
                    ┌─────────────────────────────────┐
                    │ "감사합니다.                     │
                    │  이용해 주셔서 감사합니다"        │
                    └────────────────┬────────────────┘
                                     │
                                     ▼
                              ┌─────────────┐
                              │   통화 종료  │
                              └─────────────┘
```

---

## 5. 오류 상황별 멘트

### 5.1 휴대폰 번호 입력 오류

| 상황 | 멘트 | 처리 |
|------|------|------|
| 형식 오류 | "잘못 누르셨습니다" | 재입력 안내 |
| 주문 없음 | "주문이 조회되지 않습니다. 확인 후 다시 전화해 주시기 바랍니다" | 3회 재시도 후 종료 |
| 시스템 오류 | "시스템 오류가 발생했습니다" | 서비스 종료 |

### 5.2 카드 입력 오류

| 상황 | 멘트 | 처리 |
|------|------|------|
| 형식 오류 | "잘못 누르셨습니다" | 재입력 안내 |
| 카드번호 불일치 | "잘못 누르셨습니다" | 재입력 안내 |

### 5.3 결제 처리 오류

| 상황 | 멘트 | 처리 |
|------|------|------|
| 결제 실패 | "고객님, {사유}로 인해 결제 실패하였습니다" | 실패 사유 안내 후 분기 |
| 시스템 장애 | "시스템 오류가 발생했습니다" | 서비스 종료 |
| TTS 타임아웃 | "현재 통화량이 많아 지연 상황이 발생하고 있습니다" | 서비스 종료 |

---

## 6. 음성 파일 맵핑

| 멘트 ID | 파일 경로 | 설명 |
|---------|----------|------|
| input_telnum_start | ment/Travelport/input_telnum_start | 휴대폰 번호 입력 안내 |
| input_card_num_4 | ment/Travelport/input_card_num_4 | 카드번호 뒤 4자리 입력 |
| input_pass_start | ment/Travelport/input_pass_start | 비밀번호 입력 안내 |
| pay_request_wait | ment/Travelport/pay_request_wait | 결제 요청 대기 안내 |
| no_order_msg | ment/Travelport/no_order_msg | 주문 없음 안내 |
| pay_success_msg | ment/Travelport/pay_success_msg | 결제 완료 안내 |
| input_confirm | ment/_common/common_audio/input_confirm | "맞으면 1번, 틀리면 2번" |
| service_end | ment/_common/common_audio/service_end | 서비스 종료 안내 |
| TTS_TimeOut | ment/TTS_TimeOut | TTS 타임아웃 안내 |

---

## 7. 참고사항

### 7.1 DB 카드 모드 (m_bUseDbCardInfo = TRUE)

현재 시스템은 DB 카드 모드로 동작합니다:
- 카드번호 앞 12자리: DB(RESERVED_3)에서 로드
- 유효기간: DB(RESERVED_4)에서 로드
- 할부개월: DB(RESERVED_5)에서 로드
- 사용자 입력: 카드번호 뒤 4자리 + 비밀번호 앞 2자리만

### 7.2 재시도 제한

| 항목 | 최대 횟수 |
|------|----------|
| 휴대폰 번호 입력 | 3회 |
| 카드번호 재입력 (전부 실패 시) | 3회 |
| DTMF 입력 재안내 | 3회 |

### 7.3 TTS 동적 생성

다음 멘트는 TTS로 동적 생성됩니다:
- 주문 정보 안내 (건수, 금액)
- 결제 결과 안내 (성공/실패 건수)
- 실패 사유 안내
